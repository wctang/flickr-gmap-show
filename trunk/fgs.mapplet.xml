<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs title="__MSG_title__" description="__MSG_description__" 
author="wctang" author_photo="http://farm1.static.flickr.com/219/buddyicons/81718017@N00.jpg" author_email="wctang+fgsfeedback@gmail.com"
author_link="http://blog.wctang.info/" author_location="Kaohsiung, Taiwan" author_affiliation="wctang.info"
title_url="http://code.google.com/p/flickr-gmap-show/" screenshot="http://flickr-gmap-show.googlecode.com/svn/trunk/pics/fgs_mapplet_preview.png"
thumbnail="http://flickr-gmap-show.googlecode.com/svn/trunk/pics/fgs_mapplet_thumb.png">
  <Locale messages="http://flickr-gmap-show.googlecode.com/svn/trunk/msg-en.xml"/>
  <Locale lang="zh-TW" messages="http://flickr-gmap-show.googlecode.com/svn/trunk/msg-zh-tw.xml"/>
  <Require feature="sharedmap"/>
  <Require feature="analytics"/>
</ModulePrefs>

<Content type="html"><![CDATA[
<style type="text/css">
#settingDiv, #pageDiv, #photoDiv {
    margin-bottom:10px;
}
#fgs_search_form {
    display:inline;
}

img {
    border:0px;
}

.mask {
    background:black;
    opacity:.8;
    -moz-opacity:.8;
    filter:alpha(opacity=80);
}
.mask div {
    background:white;
}

a.btn {
    cursor:pointer;
}
a.btn img {
    cursor:pointer;
}

.photos {
    height:140px;
    width:250px;
    border:solid 1px gray;
    padding:10px;
    margin:10px;
}
.photos div {
    position:relative; 
    left:0px; 
    width:250px; 
}

a.photo img {
    border : dotted 2px gray;
    padding : 1px;
    cursor : pointer;
}
a.photo:hover img {
    border : dotted 2px red;
}

.popup {
    font-size: 12px; 
    background:white;
}

</style>

<script src="http://flickr-gmap-show.googlecode.com/svn/trunk/fgs.api.js" type="text/javascript"></script>
<script type="text/javascript">
var _uacct = "UA-359113-4";

var msg_date = '__MSG_date__';
var msg_sort = '__MSG_sort__';
var msg_datetakendesc = '__MSG_datetakendesc__';
var msg_datetakenasc = '__MSG_datetakenasc__';
var msg_dateposteddesc = '__MSG_dateposteddesc__';
var msg_datepostedasc = '__MSG_datepostedasc__';
var msg_interestingnessdesc = '__MSG_interestingnessdesc__';
var msg_interestingnessasc = '__MSG_interestingnessasc__';
var msg_relevance = '__MSG_relevance__';
var msg_search = '__MSG_search__';
var msg_currpage = '__MSG_currpage__';


var deltas = [0,0,0,0,0,
2.267663023758292,
1.3145392018751147,
0.6500680377362116,
0.3163602596118622,
0.15527253613234748,
0.0768052354586608,
0.038196128656935,
0.01904511588784885,
0.009509249359091143,
0.004751266989799774,
0.002374791275833843,
0.0011871839595940514,
0.0005935388549467291,
0.0002967560452766804,
0.0001483780226383402];
var MAX_ZOOM = 19;
var MIN_ZOOM = 5;
var PHOTO_CENTER = false;

var imgdir = 'http://flickr-gmap-show.googlecode.com/svn/trunk/pics/';
var imgs = {
    loading : imgdir+'loading.gif',

    close_default  : imgdir+'simple_close_default.gif',
    close_hover    : imgdir+'simple_close_hover.gif',
    close_selected : imgdir+'simple_close_selected.gif',

    prev_default  : imgdir+'simple_prev_default.gif',
    prev_hover    : imgdir+'simple_prev_hover.gif',
    prev_selected : imgdir+'simple_prev_selected.gif',

    next_default  : imgdir+'simple_next_default.gif',
    next_hover    : imgdir+'simple_next_hover.gif',
    next_selected : imgdir+'simple_next_selected.gif',
    
    popup_default : imgdir+'simple_new_window_default.gif',
    popup_hover   : imgdir+'simple_new_window_hover.gif',
    popup_selected: imgdir+'simple_new_window_selected.gif'
};

// preload image
//for(var img in imgs) {
//    document.body.appendChild($dom('<img src="'+imgs[img]+'" width="1px" height="1px"></img>'));
//}

// mask layer
var masklayer = $dom(
    '<div class="mask" style="position:absolute; top:0px; left:0px; cursor:wait; display:none;">'+
        '<div style="position:absolute; top:100px;">'+
            '<img src="'+imgs['loading']+'"/>'+
        '</div>'+
    '</div>');
masklayer.init=false;
function mask(gmap) {
    if(!masklayer.init) {
        document.body.appendChild(masklayer);
        masklayer.init = true;
    }
    var w = document.body.clientWidth;
    var h = document.body.clientHeight;
    masklayer.style.width = w+'px';
    masklayer.style.height = h+'px';
    masklayer.firstChild.style.left = (w-32)/2 + 'px';
    masklayer.style.display = 'block';
};
function unmask() {
    masklayer.style.display = 'none';
};
</script>


<div id='settingDiv'></div>
<div id='pageDiv'></div>
<div id='photoDiv'></div>


<script type="text/javascript">

var settingDiv = $('settingDiv');
var pageDiv = $('pageDiv');
var photoDiv = $('photoDiv');

var FGS = {
    createYearBrowserMap : function() {
        var m = new FBrowser();
        m.getZoomAsync(function(z) {
            if(z > MAX_ZOOM) {
                m.setZoom(MAX_ZOOM);
            } else if(z < MIN_ZOOM) {
                m.setZoom(MIN_ZOOM);
            } else {
                m.updateview(null, null, z);
            }
        });
    },

    init : function() {
        _IG_Analytics(_uacct, "/mapplet");
        FPhotoMarker.initialize();


FPhotoMarker.prototype.onPopup = function() {
    while(photoDiv.firstChild) {
        photoDiv.removeChild(photoDiv.firstChild);
    }
    photoDiv.appendChild(this.ctx);
    
    var rand;
    if(this.photos.length<2) rand = 0;
    else rand = Math.round((this.photos.length-1)*Math.random());
    var photo = this.photos[rand];
    var owner = photo.ownername;
    if(!owner) owner = photo.owner;
    var datetaken = photo.datetaken.substr(0,10);

    // !! css style can't apply to info window !!
    var infowin = 
        '<div style="font-size:12px; width:240px;">'+
            '<b style="display: block; margin-bottom: 4px;">'+photo.title+'</b>'+
            '<img style="margin-bottom:4px;" src="' + flickr.photourl(photo,'m') + '"/><br />'+
            '<a target="_blank" href="http://www.flickr.com/photos/'+photo.owner+'/"/><img style="float:right;width:48px;height:48px;border:0px;" src="'+flickr.buddyurl(photo)+'"/></a>'+
            '<i>Posted by <a target="_blank" href="http://www.flickr.com/photos/'+photo.owner+'/"/>'+owner+'</a></i><br />'+
            '<i>Taken on '+datetaken+'</i><br />'+
            '<a target="_blank" href="'+flickr.pageurl(photo)+'">View this photo on flickr</a></div>';
    this.openInfoWindowHtml(infowin, {disableGoogleLinks:true});
};

        FBrowser.initialize();
FBrowser.prototype.updateview2 = function(bound) {
    if(bound) {
        this._lastcenter = bound.getCenter();
        this.refreshData(bound);
    } else {
        var map = this;
        map.getBoundsAsync(function(bound) {
            map._lastcenter = bound.getCenter();
            map.refreshData(bound);
        });
    }
};
FBrowser.prototype.ondragend = function() {
    var map = this;
    map.getBoundsAsync( function(bound) {
        var center = bound.getCenter();
        var delta = deltas[this.currZoom];
        if(Math.abs(center.lat()-map._lastcenter.lat())<delta && Math.abs(center.lng()-map._lastcenter.lng())<delta ) {
            return;
        } else {
            map.updateview(bound);
        }
    });
};
FBrowser.prototype.clearPanel = function() {
    while(photoDiv.firstChild) {
        photoDiv.removeChild(photoDiv.firstChild);
    }
}

        FGS.createYearBrowserMap();
    }
};

_IG_RegisterOnloadHandler(FGS.init);
</script>
]]></Content>

</Module>
